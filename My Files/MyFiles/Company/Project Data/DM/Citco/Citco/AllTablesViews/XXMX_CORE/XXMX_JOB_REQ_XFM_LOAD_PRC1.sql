--------------------------------------------------------
--  DDL for Procedure XXMX_JOB_REQ_XFM_LOAD_PRC1
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "XXMX_CORE"."XXMX_JOB_REQ_XFM_LOAD_PRC1" 
AS
--*****************************************************************************
--**
--** FILENAME  :  xxmx_kit_ppm_worker_stg.sql
--**
--** PURPOSE   :  This script Generates Worker Hire and Worker Assignment History HDL file
--**              for PPM Workers List.
--*******************************************************************************
  CURSOR JOB_VITE_DATA_CUR IS
    SELECT UNIQUE JOB_FAMILY,REQUISITIONID,JOBID,TITLE
	     , STARTDATE,ENDDATE,DEPARTMENT
         , STATUS
         /*, DECODE(CITY,'Hyderabad','Hyderabad, Telangana, India'                   
		              ,'Mumbai','Mumbai, Maharashtra, India'                       
                      ,'Makati City','Makati City, Manila, Philippines'            
					  ,'Pune','Pune, Maharashtra, India'                           
                      ,'Muntinlupa City','Muntinlupa City, Manila, Philippines'    
					  ,'Luxembourg','Luxembourg'                                   
                      ,'Toronto','Toronto, ON, Canada'                             
					  ,'Manila','Ayala Center'                                
					  ,'Changi','Changi, Singapore'                                           
					  ,'Halifax','Halifax, NS, Canada'                             
					  ,'San Francisco','San Francisco, CA, United States'          
					  ,'Jersey City','Jersey City, NJ, United States'              
					  ,'New York','New York, NY, United States'                    
					  ,'Charlotte','Charlotte, NC, United States'                                
					  ,'Fort Lauderdale','Fort Lauderdale, FL, United States'                       
					  ,'Hong Kong','Hong Kong'
					  ,'St Peter Port','St. Peter Port, Guernsey, Guernsey'
					  ,'Willemstad - De RuyterKade','Willemstad'
					  ,'Madrid','Madrid, Spain, Spain'
					  ,'St. Julian''s','St. Julian''s, Malta'
					  ,'Frankfurt','Frankfurt am Main',NULL) LOCATION_NAME
         , DECODE(CITY,'Vilnius',300000052863662
		              ,'Dublin',300000040338444
					  ,'Malvern',300000004284626
					  ,'Tortola',300000061057578
					  ,'Ebene',300000061057566
					  ,'Cork',300000040338424
					  ,'Sydney',300000037480793
					  ,'Amsterdam',300000053476680
					  ,'Willemstad',300000061057597
					  ,'London',300000017093011
					  ,'Paris',300000039303411
					  ,'Montevideo',300000052823920
					  ,'Pampanga',300000061057557
					  ,'Grand Cayman',300000052819307
					  ,'St Helier',300000061057585
					  ,'Jersey City',300000004284558
					  ,'Frankfurt am Main',300000038385740
					  ,'Singapore',300000059347025,NULL) LOCATION_ID*/ 
         ,(SELECT COMPLETE_ADDRESS FROM XXMX_JOB_REQ_MAP_TBL RMT WHERE RMT.CITY=CITY) LOCATION_NAME
		 ,(SELECT CITY_CODE FROM XXMX_JOB_REQ_MAP_TBL RMT WHERE RMT.CITY=CITY) LOCATION_ID
		 , CASE WHEN LENGTH(POSITION_CODE)>6 THEN POSITION_CODE ELSE NULL END POSITION_CODE
         ,GRADE_CODE
		 , SUBSTR(POSITION_CODE,1,6) BU_CODE
	     , STATUS CURRENT_PHASE_CODE
	     , CASE 
	         WHEN STATUS ='Draft'
	         THEN 'In Progress'
	         WHEN STATUS = 'Open'
	         then 'Unposted'
	         ELSE NULL	       END CURRENT_STATE_CODE
         , CASE 
		     WHEN EMP LIKE 'Employee%'
             THEN TO_CHAR(SUBSTR(EMP,INSTR(EMP,'=',1,1)+1,INSTR(EMP,';',1,1)-INSTR(EMP,'=',1,1)-1)) 
             ELSE NULL
           END EMP
         , CASE 
		     WHEN REC LIKE 'Employee%'
             THEN TO_CHAR(SUBSTR(REC,INSTR(REC,'=',1,1)+1,INSTR(REC,';',1,1)-INSTR(REC,'=',1,1)-1))
             ELSE NULL
           END rec
         , requisition_type
         , COMPANYNAME
		 , WORKFLOW
		 ,(SELECT UNIQUE RESPONSIBILITY FROM XXMX_POSITION_PROFILES_STG WHERE POSITION_CODE=QR.POSITION_CODE) POSITION_RESPONSIBILITY
		 ,(SELECT UNIQUE QUALIFICATION FROM XXMX_POSITION_PROFILES_STG WHERE POSITION_CODE=QR.POSITION_CODE) POSITION_QUALIFICATION
		 ,(SELECT UNIQUE DESCRIPTION FROM XXMX_POSITION_PROFILES_STG WHERE POSITION_CODE=QR.POSITION_CODE) POSITION_DESCRIPTION
		 /*, DECODE(SUBSTR(POSITION_CODE,1,6),'PH1350',300000004188858,'CA2110',300000004188871,'US2190',300000004188884,'US2230',300000004188897
                                           ,'LU2600',300000004188910,'IE2690',300000004188936,'IN2830',300000004188949,'MT3200',300000004188962
                                           ,'CW4270',300000004188975,'CA4420',300000004188988,'LT5400',300000004214027,'SG6770',300000004214053
                                           ,'VG7620',300000004214066,'KY7970',300000004214079,'GB1170',300000004214105,'PH1330',300000004214118
                                           ,'CA1480',300000004214131,'IE1520',300000004214144,'US1530',300000004214157,'AU2250',300000004214183
                                           ,'KY2370',300000004214196,'GG2520',300000004214209,'LT2540',300000004214222,'IN2810',300000004214248
                                           ,'IN2840',300000004214261,'US2870',300000004214274,'NL4320',300000004214287,'IE4350',300000004214300
                                           ,'LT5380',300000004214326,'DE5770',300000004214365,'FR5850',300000004214378,'LU6350',300000004214404
                                           ,'JE6500',300000004214430,'HK6850',300000004214443,'MU6870',300000004214456,'LU5570',300000061521296
                                           ,'CA3050',300000061521335,'UY7990',300000061521400,'NL6230',300000061521597,'CW7050',300000063394167
                                           ,'ES5470',300000063394180,'GB4120',300000063394193,'IE3220',300000063394206,'LU4370',300000063394219
                                           ,'LU5200',300000063394232,'NL2100',300000063394245,'NL6220',300000063394258,'SG2750',300000063394271,NULL) ORGANIZATION_ID */
         , (SELECT FUSION_DEPT_ID FROM XXMX_JOBVITE_DEPT_ORG_CODES WHERE JOBVITE_DEPT_NAME = QR.ORACLE_CODE_DEPARTMENT ) DEPARTMENT_ID
		 , (SELECT FUSION_ORG_CODE FROM XXMX_JOBVITE_DEPT_ORG_CODES WHERE JOBVITE_DEPT_NAME = QR.ORACLE_CODE_DEPARTMENT ) ORGANIZATION_CODE
FROM(
      SELECT CATEGORY JOB_FAMILY,REQUISITIONID,JOBID,TITLE
	       ,TO_CHAR(TO_DATE(STARTDATE,'DD/MM/YYYY HH:MI AM'),'YYYY/MM/DD HH24:MI:SS') STARTDATE
           ,TO_CHAR(TO_DATE(ENDDATE,'DD/MM/YYYY HH:MI AM'),'YYYY/MM/DD HH24:MI:SS') ENDDATE
		   ,DEPARTMENT
           , STATUS
           , HIRINGMANAGERS
           , SUBSTR(HIRINGMANAGERS,INSTR(HIRINGMANAGERS,'EmployeeId',1,1)) EMP
           , RECRUITERS
           , SUBSTR(RECRUITERS,INSTR(RECRUITERS,'EmployeeId',1,1)) REC
           , CITY
		   , COUNTRY
		   , COMPANYNAME
		   , CONFIDENTIAL_VACANCY requisition_type
      	   , WORKFLOW
		   , ORACLE_CODE_DEPARTMENT
      	   , (SELECT POSITION_CODE FROM XXMX_JOB_REQ_POSITION_CODES WHERE REQUISITION_NUMBER=REQUISITIONID) POSITION_CODE
      ,
      (SELECT SUBSTR(POSITION_CODE,INSTR(POSITION_CODE,'-',1,2)+1)||'-'||SUBSTR(POSITION_CODE,1,6) Grade
      FROM XXMX_JOB_REQ_POSITION_CODES  WHERE REQUISITION_NUMBER=REQUISITIONID) GRADE_CODE
        FROM XXMX_JOBVITE_REQUISITION_STG 
       WHERE 1=1--STATUS IN('Draft','Open')
       AND requisitionid in(SELECT REQUISITION_ID FROM XXMX_JOB_SAMPLE_REQ
	   /*'IRC83557','IRC83945','IRC84005','IRC84013','IRC84015','IRC84419','IRC84437','IRC84481','IRC84483','IRC84517','IRC84557','IRC85658','IRC85757','IRC85840','IRC86100','IRC86101','IRC86102','IRC86103','IRC86157','IRC86466'
,'IRC86489','IRC86631','IRC86654','IRC86659','IRC86661','IRC86678','IRC86679','IRC86783','IRC86784','IRC86785','IRC86786','IRC86789','IRC86793','IRC86794','IRC86795','IRC86800','IRC86801','IRC86815','IRC86816','IRC86860'
,'IRC86876'
,'IRC86969'
,'IRC87029'
,'IRC87054'
,'IRC87085'
,'IRC87238'
,'IRC87399'
,'IRC87470'
,'IRC87471'
,'IRC87472'
,'IRC87474'
,'IRC87485'
,'IRC87488'
,'IRC87489'
,'IRC87526'
,'IRC87642'
,'IRC87663'
,'IRC87675'
,'IRC87690'
,'IRC87749'
,'IRC87766'
,'IRC87826'
,'IRC87827'
,'IRC87839'
,'IRC87844'
,'IRC87851'
,'IRC87890'
,'IRC87892'
,'IRC87938'
,'IRC87992'
,'IRC87994'
,'IRC88010'
,'IRC88018'
,'IRC88019'
,'IRC88034'
,'IRC88067'
,'IRC88085'
,'IRC88096'
,'IRC88131'
,'IRC88134'
,'IRC88135'
,'IRC88136'
,'IRC88151'
,'IRC88177'
,'IRC88256'
,'IRC88278'
,'IRC88327'
,'IRC88330'
,'IRC88332'
,'IRC88344'
,'IRC88358'
,'IRC88360'
,'IRC88414'
,'IRC88443'
,'IRC88445'
,'IRC88447'
,'IRC88451'
,'IRC88462'
,'IRC88475'
,'IRC88486'
,'IRC88493'
,'IRC88568'
,'IRC88577'
,'IRC88582'
,'IRC88609'
,'IRC88622'
,'IRC88665'
,'IRC88676'
,'IRC88679'
,'IRC88680'
,'IRC88682'
,'IRC88683'
,'IRC88684'
,'IRC88687'
,'IRC88759'
,'IRC88761'
,'IRC88777'
,'IRC88787'
,'IRC88788'
,'IRC88803'
,'IRC88804'
,'IRC88820'
,'IRC88823'
,'IRC88837'
,'IRC88840'
,'IRC88858'
,'IRC88859'
,'IRC88900'
,'IRC88928'
,'IRC88948'
,'IRC88949'
,'IRC88951'
,'IRC88957'
,'IRC88958'
,'IRC88959'
,'IRC88964'
,'IRC89057'
,'IRC89061'
,'IRC89099'
,'IRC89105'
,'IRC89116'
,'IRC89118'
,'IRC89121'
,'IRC89145'
,'IRC89150'
,'IRC89238'
,'IRC89265'
,'IRC89331'
,'IRC89352'
,'IRC89377'
,'IRC89383'
,'IRC89384'
,'IRC89388'
,'IRC89405'
,'IRC89409'
,'IRC89421'
,'IRC89437'
,'IRC89486'
,'IRC89518'
,'IRC89526'
,'IRC89527'
,'IRC89529'
,'IRC89532'
,'IRC89573'
,'IRC89574'
,'IRC89619'
,'IRC89640'
,'IRC89663'
,'IRC89664'
,'IRC89667'
,'IRC89698'
,'IRC89700'
,'IRC89760'
,'IRC89861'
,'IRC89900'
,'IRC89905'
,'IRC89920'
,'IRC89939'
,'IRC89952'
,'IRC90057'
,'IRC90067'
,'IRC90078'
,'IRC90137'
,'IRC90140'
,'IRC90228'
,'IRC90299'
,'IRC90310'
,'IRC90313'
,'IRC90318'
,'IRC90333'
,'IRC90342'
,'IRC90348'
,'IRC90349'
,'IRC90355'
,'IRC90357'
,'IRC90359'
,'IRC90372'
,'IRC90395'
,'IRC90396'
,'IRC90397'
,'IRC90401'
,'IRC90404'
,'IRC90409'
,'IRC90410'
,'IRC90412'
,'IRC90422'
,'IRC90432'
,'IRC90434'
,'IRC90443'
,'IRC90445'
,'IRC90457'
,'IRC90458'
,'IRC90460'
,'IRC90475'
,'IRC90476'
,'IRC90490'
,'IRC90497'
,'IRC90498'
,'IRC90502'
,'IRC90538'
,'IRC90540'
,'IRC90542'
,'IRC90547'
,'IRC90559'
,'IRC90560'
,'IRC90563'
,'IRC90564'
,'IRC90565'
,'IRC90568'
,'IRC90571'
,'IRC90577'
,'IRC90584'
,'IRC90586'
,'IRC90593'
,'IRC90600'
,'IRC90614'
,'IRC90653'
,'IRC90656'
,'IRC90659'
,'IRC90660'
,'IRC90668'
,'IRC90670'
,'IRC90674'
,'IRC90679'
,'IRC90682'
,'IRC90683'
,'IRC90685'
,'IRC90689'
,'IRC90691'
,'IRC90693'
,'IRC90694'
,'IRC90697'
,'IRC90717'
,'IRC90721'
,'IRC90737'
,'IRC90740'
,'IRC90756'
,'IRC90761'
,'IRC90775'
,'IRC90779'
,'IRC90786'
,'IRC90791'
,'IRC90794'
,'IRC90799'
,'IRC90800'
,'IRC90804'
,'IRC90809'
,'IRC90810'
,'IRC90821'
,'IRC90826'
,'IRC90827'
,'IRC90828'
,'IRC90831'
,'IRC90840'
,'IRC90850'
,'IRC90854'
,'IRC90865'
,'IRC90867'
,'IRC90870'
,'IRC90893'
,'IRC90894'
,'IRC90898'
,'IRC90902'
,'IRC90905'
,'IRC90906'
,'IRC90915'
,'IRC90945'
,'IRC90951'
,'IRC90958'
,'IRC90963'
,'IRC90965'
,'IRC90970'
,'IRC90975'
,'IRC90980'
,'IRC90982'
,'IRC90983'
,'IRC90985'
,'IRC90987'
,'IRC90993'
,'IRC90995'
,'IRC90996'
,'IRC91011'
,'IRC91013'
,'IRC91014'
,'IRC91019'
,'IRC91043'
,'IRC91052'
,'IRC91054'
,'IRC91060'
,'IRC91061'
,'IRC91065'
,'IRC91070'
,'IRC91074'
,'IRC91129'
,'IRC91130'
,'IRC91140'
,'IRC91157'
,'IRC91160'
,'IRC91162'
,'IRC91168'
,'IRC91170'
,'IRC91171'
,'IRC91175'
,'IRC91177'
,'IRC91181'
,'IRC91182'
,'IRC91193'
,'IRC91202'
,'IRC91203'
,'IRC91206'
,'IRC91208'
,'IRC91247'
,'IRC91261'
,'IRC91265'
,'IRC91268'
,'IRC91273'
,'IRC91278'
,'IRC91279'
,'IRC91283'
,'IRC91286'
,'IRC91293'
,'IRC91298'
,'IRC91301'
,'IRC91314'
,'IRC91318'
,'IRC91325'
,'IRC91330'
,'IRC91339'
,'IRC91340'
,'IRC91341'
,'IRC91342'
,'IRC91345'
,'IRC91350'
,'IRC91367'
,'IRC91380'
,'IRC91400'
,'IRC91418'
,'IRC91420'
,'IRC91439'
,'IRC91448'
,'IRC91470'
,'IRC91475'
,'IRC91480'
,'IRC91489'
,'IRC91493'
,'IRC91498'
,'IRC91509'
,'IRC91512'
,'IRC91521'
,'IRC91541'
,'IRC91542'
,'IRC91547'
,'IRC91548'
,'IRC91552'
,'IRC91554'
,'IRC91563'
,'IRC91565'
,'IRC91566'
,'IRC91572'
,'IRC91619'
,'IRC91632'
,'IRC91636'
,'IRC91641'
,'IRC91644'
,'IRC91647'
,'IRC91651'
,'IRC91655'
,'IRC91659'
,'IRC91663'
,'IRC91667'
,'IRC91677'
,'IRC91699'
,'IRC91711'
,'IRC91720'
,'IRC91721'
,'IRC91722'
,'IRC91727'
,'IRC91730'
,'IRC91732'
,'IRC91737'
,'IRC91738'
,'IRC91747'
,'IRC91753'
,'IRC91759'
,'IRC91760'
,'IRC91776'
,'IRC91778'
,'IRC91782'
,'IRC91783'
,'IRC91784'
,'IRC91786'
,'IRC91793'
,'IRC91816'
,'IRC91818'
,'IRC91819'
,'IRC91821'
,'IRC91822'
,'IRC91824'
,'IRC91825'
,'IRC91827'
,'IRC91841'
,'IRC91843'
,'IRC91844'
,'IRC91862'
,'IRC91864'
,'IRC91871'
,'IRC91874'
,'IRC91892'
,'IRC91893'
,'IRC91894'
,'IRC91895'
,'IRC91902'
,'IRC91918'
,'IRC91920'
,'IRC91921'
,'IRC91927'
,'IRC91928'
,'IRC91932'
,'IRC91934'
,'IRC91935'
,'IRC91936'
,'IRC91939'
,'IRC91943'
,'IRC91962'
,'IRC91976'
,'IRC91980'
,'IRC91983'
,'IRC91988'
,'IRC91989'
,'IRC91992'
,'IRC91995'
,'IRC91996'
,'IRC92003'
,'IRC92006'
,'IRC92007'
,'IRC92009'
,'IRC92020'
,'IRC92021'
,'IRC92054'
,'IRC92056'
,'IRC92057'
,'IRC92058'
,'IRC92062'
,'IRC92083'
,'IRC92084'
,'IRC92085'
,'IRC92087'
,'IRC92088'
,'IRC92091'
,'IRC92121'
,'IRC92122'
,'IRC92159'
,'IRC92160'
,'IRC92164'
,'IRC92165'
,'IRC92166'
,'IRC92167'
,'IRC92169'
,'IRC92174'
,'IRC92176'
,'IRC92186'
,'IRC92188'
,'IRC92190'
,'IRC92192'
,'IRC92197'
,'IRC92200'
,'IRC92202'
,'IRC92205'
,'IRC92220'
,'IRC92225'
,'IRC92238'
,'IRC92240'
,'IRC92242'
,'IRC92243'
,'IRC92244'
,'IRC92250'
,'IRC92252'
,'IRC92258'
,'IRC92259'
,'IRC92264'
,'IRC92277'
,'IRC92319'
,'IRC92321'
,'IRC92330'
,'IRC92342'
,'IRC92343'
,'IRC92345'
,'IRC92347'
,'IRC92351'
,'IRC92353'
,'IRC92375'
,'IRC92376'
,'IRC92399'
,'IRC92401'
,'IRC92406'
,'IRC92407'
,'IRC92408'
,'IRC92478'
,'IRC92539'
,'IRC92557'
,'IRC92582'
,'IRC92584'
,'IRC92586'
,'IRC92588'
,'IRC92591'
,'IRC92592'
,'IRC92640'
,'IRC92641'
,'IRC92655'
,'IRC92659'
,'IRC92661'
,'IRC92664'
,'IRC92669'
,'IRC92670'
,'IRC92673'
,'IRC92677'
,'IRC92697'
,'IRC92702'
,'IRC92707'
,'IRC92711'
,'IRC92715'
,'IRC92721'
,'IRC92722'
,'IRC92725'
,'IRC92730'
,'IRC92736'
,'IRC92740'
,'IRC92757'
,'IRC92759'
,'IRC92763'
,'IRC92765'
,'IRC92767'
,'IRC92769'
,'IRC92771'
,'IRC92784'
,'IRC92788'
,'IRC92797'
,'IRC92838'
,'IRC92841'
,'IRC92860'
,'IRC92879'
,'IRC92882'
,'IRC92885'
,'IRC92887'
,'IRC92888'
,'IRC92892'
,'IRC92897'
,'IRC92898'
,'IRC92899'
,'IRC92900'
,'IRC92903'
,'IRC92906'
,'IRC92908'
,'IRC92909'
,'IRC92910'
,'IRC92911'
,'IRC92912'
,'IRC92913'
,'IRC92914'
,'IRC92927'
,'IRC92928'
,'IRC92929'
,'IRC92932'
,'IRC92937'
,'IRC92940'
,'IRC92941'
,'IRC92946'
,'IRC92948'
,'IRC92950'
,'IRC92951'
,'IRC92952'
,'IRC92954'
,'IRC92957'
,'IRC92960'
,'IRC92963'
,'IRC92967'
,'IRC92973'
,'IRC92984'
,'IRC92991'
,'IRC92994'
,'IRC92995'
,'IRC93017'
,'IRC93018'
,'IRC93021'
,'IRC93023'
,'IRC93025'
,'IRC93027'
,'IRC93029'
,'IRC93032'
,'IRC93033'
,'IRC93034'
,'IRC93038'
,'IRC93042'
,'IRC93045'
,'IRC93048'
,'IRC93056'
,'IRC93058'
,'IRC93062'
,'IRC93066'
,'IRC93080'
,'IRC93081'
,'IRC93098'
,'IRC93099'
,'IRC93101'
,'IRC93104'
,'IRC93105'
,'IRC93106'
,'IRC93118'
,'IRC93120'
,'IRC93121'
,'IRC93122'
,'IRC93123'
,'IRC93124'
,'IRC93125'
,'IRC93126'
,'IRC93127'
,'IRC93128'
,'IRC93129'
,'IRC93130'
,'IRC93131'
,'IRC93132'
,'IRC93133'
,'IRC93134'
,'IRC93135'
,'IRC93141'
,'IRC93142'
,'IRC93144'
,'IRC93148'
,'IRC93149'
,'IRC93151'
,'IRC93152'
,'IRC93153'
,'IRC93155'
,'IRC93156'
,'IRC93161'
,'IRC93162'
,'IRC93165'
,'IRC93167'
,'IRC93172'
,'IRC93173'
,'IRC93175'
,'IRC93178'
,'IRC93179'
,'IRC93183'
,'IRC93184'
,'IRC93188'
,'IRC93189'
,'IRC93190'
,'IRC93194'
,'IRC93197'
,'IRC93209'
,'IRC93217'
,'IRC93219'
,'IRC93220'
,'IRC93222'
,'IRC93225'
,'IRC93226'
,'IRC93227'
,'IRC93228'
,'IRC93230'
,'IRC93233'
,'IRC93235'
,'IRC93236'
,'IRC93239'
,'IRC93241'
,'IRC93242'
,'IRC93243'
,'IRC93244'
,'IRC93245'
,'IRC93246'
,'IRC93247'
,'IRC93249'
,'IRC93257'
,'IRC93266'
,'IRC93277'
,'IRC93278'
,'IRC93279'
,'IRC93280'
,'IRC93281'
,'IRC93282'
,'IRC93283'
,'IRC93284'
,'IRC93285'
,'IRC93286'
,'IRC93288'
,'IRC93306'
,'IRC93307'
,'IRC93308'
,'IRC93309'
,'IRC93310'
,'IRC93311'
,'IRC93312'
,'IRC93313'
,'IRC93314'
,'IRC93315'
,'IRC93317'
,'IRC93319'
,'IRC93321'
,'IRC93323'
,'IRC93325'
,'IRC93328'
,'IRC93330'
,'IRC93331'
,'IRC93333'
,'IRC93346'
,'IRC93352'
,'IRC93357'
,'IRC93358'
,'IRC93359'
,'IRC93360'
,'IRC93361'
,'IRC93369'
,'IRC93378'
,'IRC93381'
,'IRC93384'
,'IRC93386'
,'IRC93390'
,'IRC93392'
,'IRC93395'
,'IRC93397'
,'IRC93411'
,'IRC93416'
,'IRC93417'
,'IRC93418'
,'IRC93420'
,'IRC93421'
,'IRC93439'
,'IRC93443'
,'IRC93444'
,'IRC93449'
,'IRC93450'
,'IRC93452'
,'IRC93453'
,'IRC93455'
,'IRC93478'
,'IRC93481'
,'IRC93487'
,'IRC93493'
,'IRC93494'
,'IRC93496'
,'IRC93501'
,'IRC93503'
,'IRC93505'
,'IRC93509'
,'IRC93519'
,'IRC93525'
,'IRC93537'
,'IRC93538'
,'IRC93558'
,'IRC93579'
,'IRC93597'
,'IRC93598'
,'IRC93602'
,'IRC93612'
,'IRC93615'
,'IRC93616'
,'IRC93620'
,'IRC93622'
,'IRC93625'
,'IRC93627'
,'IRC93628'
,'IRC93634'
,'IRC93636'
,'IRC93642'
,'IRC93648'
,'IRC93649'
,'IRC93654'
,'IRC93655'
,'IRC93656'
,'IRC93676'
,'IRC93679'
,'IRC93680'
,'IRC93682'
,'IRC93683'
,'IRC93686'
,'IRC93687'
,'IRC93688'
,'IRC93697'
,'IRC93703'
,'IRC93704'
,'IRC93705'
,'IRC93706'
,'IRC93707'
,'IRC93711'
,'IRC93712'
,'IRC93713'
,'IRC93716'
,'IRC93718'
,'IRC93722'
,'IRC93728'
,'IRC93729'
,'IRC93730'
,'IRC93732'
,'IRC93733'
,'IRC93735'
,'IRC93736'
,'IRC93739'
,'IRC93740'
,'IRC93741'
,'IRC93742'
,'IRC93744'
,'IRC93745'
,'IRC93747'
,'IRC93757'
,'IRC93760'
,'IRC93766'
,'IRC93767'
,'IRC93781'
,'IRC93783'
,'IRC93797'
,'IRC93798'
,'IRC93799'
,'IRC93861'
,'IRC93862'
,'IRC93863'
,'IRC93864'
,'IRC93865'
,'IRC93872'
,'IRC93879'
,'IRC93881'
,'IRC93883'
,'IRC93891'
,'IRC93912'
,'IRC93914'
,'IRC93916'
,'IRC93919'
,'IRC93921'
,'IRC93927'
,'IRC93939'
,'IRC93940'
,'IRC93941'
,'IRC93943'
,'IRC93955'
,'IRC93962'
,'IRC93965'
,'IRC93966'
,'IRC93982'
,'IRC93991'
,'IRC93997'
,'IRC93999'
,'IRC94001'
,'IRC94004'
,'IRC94006'
,'IRC94007'
,'IRC94011'
,'IRC94017'
,'IRC94018'
,'IRC94023'
,'IRC94031'
,'IRC94034'
,'IRC94036'
,'IRC94037'
,'IRC94041'
,'IRC94043'
,'IRC94048'
,'IRC94049'
,'IRC94050'
,'IRC94051'
,'IRC94052'
,'IRC94054'
,'IRC94055'
,'IRC94056'
,'IRC94057'
,'IRC94088'
,'IRC94098'
,'IRC94099'
,'IRC94100'
,'IRC94102'
,'IRC94103'
,'IRC94105'
,'IRC94137'
,'IRC94141'
,'IRC94143'
,'IRC94162'
,'IRC94168'
,'IRC94175'
,'IRC94176'
,'IRC94178'
,'IRC94179'
,'IRC94184'
,'IRC94185'
,'IRC94189'
,'IRC94200'
,'IRC94202'
,'IRC94204'
,'IRC94211'
,'IRC94217'
,'IRC94218'
,'IRC94223'
,'IRC94224'
,'IRC94228'
,'IRC94232'
,'IRC94233'
,'IRC94236'
,'IRC94237'
,'IRC94239'
,'IRC94241'
,'IRC94249'
,'IRC94267'
,'IRC94269'
,'IRC94289'
,'IRC94311'
,'IRC94315'
,'IRC94326'
,'IRC94360'
,'IRC94361'
,'IRC94402'
,'IRC94423'
,'IRC94430'
,'IRC94432'
,'IRC94520'
,'IRC94521'
,'IRC94525'
,'IRC94534'
,'IRC94549'
,'IRC94574'
,'IRC94580'
,'IRC94589'
,'IRC94676'
,'IRC94703'
,'IRC94704'
,'IRC94705'
,'IRC94715'
,'IRC94719'
,'IRC94732'
,'IRC94783'
,'IRC94807'
,'IRC94845'
,'IRC94846'
,'IRC94851'
,'IRC94917'
,'IRC94953'
,'IRC95011'
,'IRC95038'
,'IRC95149'
,'IRC95176'
,'IRC95268'*/) 
  /*UNION
      SELECT CATEGORY JOB_FAMILY,REQUISITIONID,JOBID,TITLE
	       ,TO_CHAR(TO_DATE(STARTDATE,'DD/MM/YYYY HH:MI AM'),'YYYY/MM/DD HH24:MI:SS') STARTDATE
           ,TO_CHAR(TO_DATE(ENDDATE,'DD/MM/YYYY HH:MI AM'),'YYYY/MM/DD HH24:MI:SS') ENDDATE
	       ,DEPARTMENT
           , STATUS
           , HIRINGMANAGERS
           , SUBSTR(HIRINGMANAGERS,INSTR(HIRINGMANAGERS,'EmployeeId',1,2)) EMP
           , RECRUITERS
           , SUBSTR(RECRUITERS,INSTR(RECRUITERS,'EmployeeId',1,2)) REC
           , LOCATION
		   , COMPANYNAME
		   , "CONFIDENTIAL VACANCY" requisition_type
      	   , WORKFLOW
      	   , (SELECT POSITION_CODE FROM XXMX_JOB_REQ_POSITION_CODES WHERE REQUISITION_NUMBER=REQUISITIONID) POSITION_CODE
        FROM XXMX_JOBVITE_REQUISITION_STG
       WHERE STATUS IN('Draft','Open')
         AND requisitionid IN('IRC57676','IRC57821','IRC61819','IRC74178','277')
         AND (REGEXP_COUNT(HIRINGMANAGERS,'EmployeeId')>1
             OR REGEXP_COUNT(RECRUITERS,'EmployeeId')>1)	 */
) QR;


  TYPE JOB_VITE_DATA IS TABLE OF JOB_VITE_DATA_CUR%ROWTYPE INDEX BY PLS_INTEGER;
  JOB_VITE_TBL    JOB_VITE_DATA;

  --JOB_VITE_DATA_LIMIT NUMBER := 5000;

BEGIN
   DELETE FROM XXMX_HCM_IREC_JOB_REQ_XFM;
   DELETE FROM XXMX_HCM_IREC_JR_HIRE_TEAM_XFM;
   DELETE FROM XXMX_HCM_IREC_JR_POST_DET_XFM;

   COMMIT;

   OPEN JOB_VITE_DATA_CUR;
     FETCH JOB_VITE_DATA_CUR BULK COLLECT INTO JOB_VITE_TBL;-- LIMIT JOB_VITE_DATA_LIMIT;

       --EXIT WHEN JOB_VITE_TBL.COUNT = 0;
       FORALL i IN 1..JOB_VITE_TBL.COUNT
         INSERT INTO XXMX_HCM_IREC_JOB_REQ_XFM( JOB_FAMILY_NAME   
                                               , DEPARTMENT_NAME
                                               , CURRENT_PHASE_CODE
                                               , CURRENT_STATE_CODE
                                               , HIRING_MANAGER_PERSON_NUMBER
                                               --, HIRING_MANAGER_ASSIGNMENT_NUMBER
                                               , RECRUITER_PERSON_NUMBER
                                               --, RECRUITER_ASSIGNMENT_NUMBER
                                               , PRIMARY_LOCATION_NAME  
											   , PRIMARY_LOCATION_ID
											   , REQUISITION_NUMBER
											   , REQUISITION_TITLE
											   , RECRUITING_TYPE
											   , ORGANIZATION_NAME
											   , CANDIDATE_SELECTION_PROCESS_CODE
                                               , POSITION_CODE
											   , BUSINESS_UNIT_SHORT_CODE
											   --, ORGANIZATION_ID
											   , POSITION_DESCRIPTION
											   , POSITION_QUALIFICATION
											   , POSITION_RESPONSIBILITY
											   , DEPARTMENT_ID
											   , ORGANIZATION_CODE
                                               ,GRADE_CODE)
                                       VALUES (JOB_VITE_TBL(i).JOB_FAMILY
                                              , JOB_VITE_TBL(i).DEPARTMENT
                                              , JOB_VITE_TBL(i).CURRENT_PHASE_CODE
                                              , JOB_VITE_TBL(i).CURRENT_STATE_CODE
                                              , JOB_VITE_TBL(i).EMP
                                              , JOB_VITE_TBL(i).REC
                                              , JOB_VITE_TBL(i).LOCATION_NAME
											  , JOB_VITE_TBL(i).LOCATION_ID
											  , JOB_VITE_TBL(i).REQUISITIONID
											  , JOB_VITE_TBL(i).TITLE
											  , JOB_VITE_TBL(i).requisition_type
											  , JOB_VITE_TBL(i).COMPANYNAME
											  , JOB_VITE_TBL(i).WORKFLOW 
											  , JOB_VITE_TBL(i).POSITION_CODE
											  , JOB_VITE_TBL(i).BU_CODE
											  --, JOB_VITE_TBL(i).ORGANIZATION_ID
											  , JOB_VITE_TBL(i).POSITION_DESCRIPTION
											  , JOB_VITE_TBL(i).POSITION_QUALIFICATION
											  , JOB_VITE_TBL(i).POSITION_RESPONSIBILITY
											  , JOB_VITE_TBL(i).DEPARTMENT_ID
											  , JOB_VITE_TBL(i).ORGANIZATION_CODE
                                              , JOB_VITE_TBL(i).GRADE_CODE);

       FORALL j IN 1..JOB_VITE_TBL.COUNT
         INSERT INTO XXMX_HCM_IREC_JR_HIRE_TEAM_XFM( REQUISITION_NUMBER )
                                               VALUES ( JOB_VITE_TBL(j).REQUISITIONID );

	   FORALL k IN 1..JOB_VITE_TBL.COUNT
         INSERT INTO XXMX_HCM_IREC_JR_POST_DET_XFM( PUBLISHED_JOB_ID 
                                                  , REQUISITION_NUMBER
                                                  , START_DATE
                                                  , END_DATE )
                                           VALUES ( JOB_VITE_TBL(k).JOBID
                                                   ,JOB_VITE_TBL(k).REQUISITIONID		
                                                   ,NVL(JOB_VITE_TBL(k).STARTDATE,'0001/01/01 00:00:00')
                                                   ,JOB_VITE_TBL(k).ENDDATE	 ); 
    COMMIT;

   CLOSE JOB_VITE_DATA_CUR;
END XXMX_JOB_REQ_XFM_LOAD_PRC1;

/
