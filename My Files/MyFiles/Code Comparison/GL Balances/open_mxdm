     PROCEDURE gl_opening_balances_stg
                    (
                       pt_i_MigrationSetID             IN      xxmx_migration_headers.migration_set_id%TYPE,
                       pt_i_SubEntity                  IN      xxmx_migration_metadata.sub_entity%TYPE
                    )
     IS
          --
          --
          --**********************
          --** CURSOR Declarations
          --**********************
          --
          -- Cursor to get the opening GL balance
          --
          CURSOR GLBalances_cur
                      (
                       pv_LedgerName                   VARCHAR2                
                      ,pv_ExtractYear                  VARCHAR2
                      ,pv_PeriodName                   VARCHAR2

                      )
          IS
               --
               --
             SELECT  
                       'NEW'                                             fusion_status_code
                      ,gl.name                                           ledger_name
                      ,gl.ledger_id                                           ledger_id
                      ,(SELECT gp.end_date
                        FROM   gl.gl_periods@MXDM_NVIS_EXTRACT gp
                        WHERE  gp.period_name = xbal.period_name
                        AND    gp.period_set_name= gl.period_set_name)        accounting_date

                      ,(
                        SELECT parameter_value 
                        FROM   xxmx_core.xxmx_migration_parameters 
                        WHERE  application_suite = gct_ApplicationSuite
                        AND    application = gct_Application 
                        AND    business_entity = gct_BusinessEntity
                        AND    parameter_code='BATCH_SOURCE'
                       )                                                user_je_source_name
                      ,( SELECT parameter_value 
                        FROM   xxmx_core.xxmx_migration_parameters 
                        WHERE  application_suite = 'FIN'
                        AND    application = 'GL' 
                        AND    business_entity = gct_BusinessEntity
                        AND    parameter_code='BATCH_CATEGORY_NAME'
                       )                                             user_je_category_name
                      ,xbal.currency_code                                currency_code
                      ,TRUNC(SYSDATE)                                    date_created  
                      ,'A'                                               actual_flag
                      ,gcc.segment1                                      segment1
                      ,gcc.segment2                                      segment2
                      ,gcc.segment3                                      segment3
                      ,gcc.segment4                                      segment4
                      ,gcc.segment5                                      segment5
                      ,gcc.segment6                                      segment6
                      ,gcc.segment7                                      segment7
                      ,gcc.segment8                                      segment8
                      ,gcc.segment9                                      segment9
                      ,gcc.segment10                                     segment10
                      ,gcc.segment11                                     segment11
                      ,gcc.segment12                                     segment12
                      ,gcc.segment13                                     segment13
                      ,gcc.segment14                                     segment14
                      ,gcc.segment15                                     segment15
                      ,gcc.segment16                                     segment16
                      ,gcc.segment17                                     segment17
                      ,gcc.segment18                                     segment18
                      ,gcc.segment19                                     segment19
                      ,gcc.segment20                                     segment20
                      ,gcc.segment21                                     segment21
                      ,gcc.segment22                                     segment22
                      ,gcc.segment23                                     segment23
                      ,gcc.segment24                                     segment24
                      ,gcc.segment25                                     segment25
                      ,gcc.segment26                                     segment26
                      ,gcc.segment27                                     segment27
                      ,gcc.segment28                                     segment28
                      ,gcc.segment29                                     segment29
                      ,gcc.segment30                                     segment30
                      ,xbal.entered_dr                                   entered_dr
                      ,xbal.entered_cr                                   entered_cr
                      ,xbal.accounted_dr                                 accounted_dr
                      ,xbal.accounted_cr                                 accounted_cr
                      ,'ACTUAL BALANCE MIGRATION'
                     ||' '
                     ||xbal.period_name                                  reference1                        -- CV040 states this should be the Batch Name
                      ,''                                                reference2                        -- CV040 states this should be the Batch Description
                      ,''                                                reference3                        -- CV040 does not reference this (FBDI Template has no column for it)
                      ,'ACTUAL BALANCE MIGRATION'                                                          
                     ||' '                                                                                 
                     ||xbal.period_name                                  reference4                      -- CV040 states this should be the Journal Entry Name
                      ,''                                                reference5                        -- CV040 states this should be the Journal Entry Description
                      ,''                                                reference6                        -- CV040 states this should be the Journal Entry Reference
                      ,''                                                reference7                        -- CV040 states this should be the Journal Entry Reversal Flag
                      ,''                                                reference8                        -- CV040 states this should be the Journal entry Reversal Period
                      ,''                                                reference9                        -- CV040 states this should be the Journal Reversal Method
                      ,gcck.concatenated_segments                        reference10                       -- CV040 states this should be the Journal entry Line Description
                      ,''                                                stat_amount
                      ,''                                                user_currency_conversion_type
                      --,gjh.currency_conversion_date                      currency_conversion_date
                      ,''                                                currency_conversion_date
                      ,''                                                currency_conversion_rate
                      ,''                                                attribute_category
                      ,''                                                attribute1
                      ,''                                                attribute2
                      ,''                                                attribute3
                      ,''                                                attribute4
                      ,''                                                attribute5
                      ,''                                                attribute6
                      ,''                                                attribute7
                      ,''                                                attribute8
                      ,''                                                attribute9
                      ,''                                                attribute10
                      ,''                                                attribute11
                      ,''                                                attribute12
                      ,''                                                attribute13
                      ,''                                                attribute14
                      ,''                                                attribute15
                      ,''                                                attribute16
                      ,''                                                attribute17
                      ,''                                                attribute18
                      ,''                                                attribute19
                      ,''                                                attribute20
                      ,''                                                attribute_category3
-- MA 27/04/2022 no longer required
--                      ,''                                                average_journal_flag
                      ,''                                                originating_bal_seg_value
                      ,''                                                encumbrance_type_id
                      ,''                                                jgzz_recon_ref
                      ,xbal.period_name                                  period_name
             FROM   apps.gl_ledgers@MXDM_NVIS_EXTRACT                         gl,
                    xxmx_core.XXMX_GL_OPENING_BALANCE_V                  xbal,
                    apps.gl_code_combinations@MXDM_NVIS_EXTRACT               gcc,
                    apps.gl_code_combinations_kfv@MXDM_NVIS_EXTRACT           gcck
             WHERE  gl.name                                         = pv_LedgerName

             AND    xbal.ledger_id                                  = gl.ledger_id
             AND    xbal.period_name                                = pv_PeriodName
-- Added by MA 23/03/2022 to eliminate the zero lines
             and    ( nvl(xbal.entered_dr,0)!=0 or nvl(xbal.entered_cr,0)!=0 or nvl(xbal.accounted_dr,0)!=0 or nvl(xbal.accounted_cr,0)!=0)
--             AND    nvl(xbal.entered_dr,0)+nvl(xbal.entered_cr,0)   > 0
             AND    gcc.code_combination_id                         = xbal.code_combination_id
		     AND    gcck.code_combination_id                        = gcc.code_combination_id;
--             AND    gcc.segment1 = substr(pv_ou_name,3);

          --
          -- Cursor to get the ledger names
          -- 

          --********************
          --** Type Declarations
          --********************
          --
          TYPE gl_balances_tt IS TABLE OF GLBalances_cur%ROWTYPE INDEX BY BINARY_INTEGER;
          --
          --
          --************************
          --** Constant Declarations
          --************************
          --
          /*
          ** This is declared in each Procedure within the package to allow for
          ** a different value to be assigned in the Staging/Transform/Export
          ** procedures.
          */
          --
          cv_ProcOrFuncName               CONSTANT  VARCHAR2(30)                           := 'gl_opening_balances_stg';
          ct_StgTable                     CONSTANT  xxmx_migration_metadata.stg_table%TYPE := 'xxmx_gl_opening_balances_stg';
          ct_Phase                        CONSTANT  xxmx_module_messages.phase%TYPE        := 'EXTRACT';
          --
          --
          --************************
          --** Variable Declarations
          --************************
          --
          vt_ListParameterCode            xxmx_migration_parameters.parameter_code%TYPE;
          vn_ListValueCount               NUMBER;
          vb_OkayToExtract                BOOLEAN;
          vb_PeriodAndYearMatch           BOOLEAN;
          --
          --
          --****************************
          --** Record Table Declarations
          --****************************
          --
          --
          --
          --****************************
          --** PL/SQL Table Declarations
          --****************************
          --
          EmptyExtractYear_tbl            xxmx_utilities_pkg.g_ParamValueList_tt;
          ExtractYear_tbl                 xxmx_utilities_pkg.g_ParamValueList_tt;
          EmptyPeriodName_tbl             xxmx_utilities_pkg.g_ParamValueList_tt;
          PeriodName_tbl                  xxmx_utilities_pkg.g_ParamValueList_tt;
          GLBalances_tbl                  gl_balances_tt;
         -- LedgerScope_tbl1                 LedgerName_tt;  
		  LedgerName_tbl                  xxmx_utilities_pkg.g_ParamValueList_tt;

          --
          vt_SubEntity                    CONSTANT  xxmx_module_messages.sub_entity%TYPE         := 'OPEN_BAL';
          vt_MigrationSetID               xxmx_migration_headers.migration_set_id%TYPE;
          --
          --*************************
          --** Exception Declarations
          --*************************
          --
          e_ModuleError                   EXCEPTION;
          --
          --
     --** END Declarations
     --
     --
BEGIN
    --
    gvv_ProgressIndicator := '0010';
	gct_BusinessEntity := 'OPEN_BAL';--1.3--Commented by Sinchana---
    --
    vb_OkayToExtract  := TRUE;
    gvv_ReturnStatus  := '';
    gvt_ReturnMessage := '';
    vt_MigrationSetID := pt_i_MigrationSetID;
    --
    xxmx_utilities_pkg.clear_messages
               (
                pt_i_ApplicationSuite => gct_ApplicationSuite
               ,pt_i_Application      => gct_Application
               ,pt_i_BusinessEntity   => gct_BusinessEntity
               ,pt_i_SubEntity        => vt_SubEntity
               ,pt_i_Phase            => ct_Phase
               ,pt_i_MessageType      => 'MODULE'
               ,pv_o_ReturnStatus     => gvv_ReturnStatus
               );
    --
    gvn_RowCount := xxmx_utilities_pkg.get_row_count
                                         (
                                          gct_StgSchema
                                         ,ct_StgTable
                                         ,vt_MigrationSetID
                                         );
    IF   gvv_ReturnStatus = 'F'
    THEN
        --
        xxmx_utilities_pkg.log_module_message
                    (
                     pt_i_ApplicationSuite  => gct_ApplicationSuite
                    ,pt_i_Application       => gct_Application
                    ,pt_i_BusinessEntity    => gct_BusinessEntity
                    ,pt_i_SubEntity         => vt_SubEntity
                    ,pt_i_MigrationSetID    => vt_MigrationSetID
                    ,pt_i_Phase             => ct_Phase
                    ,pt_i_Severity          => 'ERROR'
                    ,pt_i_PackageName       => gcv_PackageName
                    ,pt_i_ProcOrFuncName    => cv_ProcOrFuncName
                    ,pt_i_ProgressIndicator => gvv_ProgressIndicator
                    ,pt_i_ModuleMessage     => '  - Oracle error in called procedure "xxmx_utilities_pkg.clear_messages".'
                    ,pt_i_OracleError       => gvt_ReturnMessage
                    );
               --
        RAISE e_ModuleError;
               --
    END IF;
          --
    gvv_ProgressIndicator := '0020';
    --
    gvv_ReturnStatus  := '';
    gvt_ReturnMessage := '';
    --
    xxmx_utilities_pkg.clear_messages
               (
                pt_i_ApplicationSuite => gct_ApplicationSuite
               ,pt_i_Application      => gct_Application
               ,pt_i_BusinessEntity   => gct_BusinessEntity
               ,pt_i_SubEntity        => vt_SubEntity
               ,pt_i_Phase            => ct_Phase
               ,pt_i_MessageType      => 'DATA'
               ,pv_o_ReturnStatus     => gvv_ReturnStatus
               );
          --
    IF   gvv_ReturnStatus = 'F'
    THEN
        --
        xxmx_utilities_pkg.log_module_message
                    (
                     pt_i_ApplicationSuite  => gct_ApplicationSuite
                    ,pt_i_Application       => gct_Application
                    ,pt_i_BusinessEntity    => gct_BusinessEntity
                    ,pt_i_SubEntity         => vt_SubEntity
                    ,pt_i_MigrationSetID    => vt_MigrationSetID
                    ,pt_i_Phase             => ct_Phase
                    ,pt_i_Severity          => 'ERROR'
                    ,pt_i_PackageName       => gcv_PackageName
                    ,pt_i_ProcOrFuncName    => cv_ProcOrFuncName
                    ,pt_i_ProgressIndicator => gvv_ProgressIndicator
                    ,pt_i_ModuleMessage     => '  - Oracle error in called procedure "xxmx_utilities_pkg.clear_messages".'
                    ,pt_i_OracleError       => gvt_ReturnMessage
                    );
               --
               RAISE e_ModuleError;
               --
    END IF;
    --
    gvv_ProgressIndicator := '0030';
    --
    xxmx_utilities_pkg.log_module_message
               (
                pt_i_ApplicationSuite  => gct_ApplicationSuite
               ,pt_i_Application       => gct_Application
               ,pt_i_BusinessEntity    => gct_BusinessEntity
               ,pt_i_SubEntity         => vt_SubEntity
               ,pt_i_MigrationSetID    => vt_MigrationSetID
               ,pt_i_Phase             => ct_Phase
               ,pt_i_Severity          => 'NOTIFICATION'
               ,pt_i_PackageName       => gcv_PackageName
               ,pt_i_ProcOrFuncName    => cv_ProcOrFuncName
               ,pt_i_ProgressIndicator => gvv_ProgressIndicator
               ,pt_i_ModuleMessage     => '  - Procedure "'||gcv_PackageName||'.'||cv_ProcOrFuncName||'" initiated.'
               ,pt_i_OracleError       => NULL
               );
          --
    gvv_ProgressIndicator := '0040';
    --
    --** If the Migration Set ID is NULL then the Migration has not been initialized.
    --
    IF   vt_MigrationSetID IS NOT NULL THEN
        --
        xxmx_utilities_pkg.log_module_message
                    (
                     pt_i_ApplicationSuite  => gct_ApplicationSuite
                    ,pt_i_Application       => gct_Application
                    ,pt_i_BusinessEntity    => gct_BusinessEntity
                    ,pt_i_SubEntity         => vt_SubEntity
                    ,pt_i_MigrationSetID    => vt_MigrationSetID
                    ,pt_i_Phase             => ct_Phase
                    ,pt_i_Severity          => 'NOTIFICATION'
                    ,pt_i_PackageName       => gcv_PackageName
                    ,pt_i_ProcOrFuncName    => cv_ProcOrFuncName
                    ,pt_i_ProgressIndicator => gvv_ProgressIndicator
                    ,pt_i_ModuleMessage     => '    - Retrieving ledger details from scope table.'
                    ,pt_i_OracleError       => NULL
                    );
               --
        gvv_ProgressIndicator := '0045';
        --
        gvt_MigrationSetName := xxmx_utilities_pkg.get_migration_set_name(pt_i_MigrationSetID);
        --
    /*    begin
            OPEN  getLedger_cur;
            FETCH getLedger_cur
                       BULK COLLECT
                       INTO  LedgerScope_tbl1;
            CLOSE getLedger_cur;
        exception
            when others then
                   xxmx_utilities_pkg.log_module_message
                        (
                         pt_i_ApplicationSuite  => gct_ApplicationSuite
                        ,pt_i_Application       => gct_Application
                        ,pt_i_BusinessEntity    => gct_BusinessEntity
                        ,pt_i_SubEntity         => vt_SubEntity
                        ,pt_i_MigrationSetID    => vt_MigrationSetID
                        ,pt_i_Phase             => ct_Phase
                        ,pt_i_Severity          => 'NOTIFICATION'
                        ,pt_i_PackageName       => gcv_PackageName
                        ,pt_i_ProcOrFuncName    => cv_ProcOrFuncName
                        ,pt_i_ProgressIndicator => gvv_ProgressIndicator
                        ,pt_i_ModuleMessage     => '    - err: '||sqlerrm
                        ,pt_i_OracleError       => NULL
                        );
        end;
        --
        xxmx_utilities_pkg.log_module_message
                    (
                     pt_i_ApplicationSuite  => gct_ApplicationSuite
                    ,pt_i_Application       => gct_Application
                    ,pt_i_BusinessEntity    => gct_BusinessEntity
                    ,pt_i_SubEntity         => vt_SubEntity
                    ,pt_i_MigrationSetID    => vt_MigrationSetID
                    ,pt_i_Phase             => ct_Phase
                    ,pt_i_Severity          => 'NOTIFICATION'
                    ,pt_i_PackageName       => gcv_PackageName
                    ,pt_i_ProcOrFuncName    => cv_ProcOrFuncName
                    ,pt_i_ProgressIndicator => gvv_ProgressIndicator
                    ,pt_i_ModuleMessage     => '    - Ledger scope count: '||LedgerScope_tbl1.count()
                    ,pt_i_OracleError       => NULL
                    );
        --
       /*
               ** The Migration Set has been initialized so not retrieve the
               ** Parameters for extracting GL Balances:
               **
               ** 1) GL Ledger Name List
               ** 2) Extract Years List
               ** 3) GL Period Name List
               */
               --
               /*
               ** Retrieve GL Ledger Names List
               */
               gvv_ProgressIndicator := '0046';
               --
               vt_ListParameterCode := 'LEDGER_NAME';
               vn_ListValueCount    := 0;
               gvv_ReturnStatus     := '';
               gvt_ReturnMessage    := '';
               --
               xxmx_utilities_pkg.log_module_message
                    (
                     pt_i_ApplicationSuite  => gct_ApplicationSuite
                    ,pt_i_Application       => gct_Application
                    ,pt_i_BusinessEntity    => gct_BusinessEntity
                    ,pt_i_SubEntity         => pt_i_SubEntity
                    ,pt_i_Phase             => ct_Phase
                    ,pt_i_Severity          => 'NOTIFICATION'
                    ,pt_i_PackageName       => gcv_PackageName
                    ,pt_i_ProcOrFuncName    => cv_ProcOrFuncName
                    ,pt_i_ProgressIndicator => gvv_ProgressIndicator
                    ,pt_i_ModuleMessage     => '    - Retrieving "'
                                             ||vt_ListParameterCode
                                             ||'" List from Migration Parameters table:'
                    ,pt_i_OracleError       => NULL
                    );
               --
               LedgerName_tbl := xxmx_utilities_pkg.get_parameter_value_list
                                      (
                                       pt_i_ApplicationSuite => gct_ApplicationSuite
                                      ,pt_i_Application      => gct_Application
                                      ,pt_i_BusinessEntity   => gct_BusinessEntity
                                      ,pt_i_SubEntity        => pt_i_SubEntity
                                      ,pt_i_ParameterCode    => vt_ListParameterCode
                                      ,pn_o_ReturnCount      => vn_ListValueCount
                                      ,pv_o_ReturnStatus     => gvv_ReturnStatus
                                      ,pv_o_ReturnMessage    => gvt_ReturnMessage
                                      );
               --
               IF   gvv_ReturnStatus = 'F'
               THEN
                    --
                    xxmx_utilities_pkg.log_module_message
                         (
                          pt_i_ApplicationSuite  => gct_ApplicationSuite
                         ,pt_i_Application       => gct_Application
                         ,pt_i_BusinessEntity    => gct_BusinessEntity
                         ,pt_i_SubEntity         => pt_i_SubEntity
                         ,pt_i_Phase             => ct_Phase
                         ,pt_i_Severity          => 'ERROR'
                         ,pt_i_PackageName       => gcv_PackageName
                         ,pt_i_ProcOrFuncName    => cv_ProcOrFuncName
                         ,pt_i_ProgressIndicator => gvv_ProgressIndicator
                         ,pt_i_ModuleMessage     => '      - Oracle error in called procedure "xxmx_utilities_pkg.get_parameter_value_list".  "'
                                                  ||vt_ListParameterCode
                                                  ||'" List could not be retrieved.'
                         ,pt_i_OracleError       => gvt_ReturnMessage
                         );
                    --
                    RAISE e_ModuleError;
                    --
               ELSE
                    --
                    xxmx_utilities_pkg.log_module_message
                         (
                          pt_i_ApplicationSuite  => gct_ApplicationSuite
                         ,pt_i_Application       => gct_Application
                         ,pt_i_BusinessEntity    => gct_BusinessEntity
                         ,pt_i_SubEntity         => pt_i_SubEntity
                         ,pt_i_Phase             => ct_Phase
                         ,pt_i_Severity          => 'NOTIFICATION'
                         ,pt_i_PackageName       => gcv_PackageName
                         ,pt_i_ProcOrFuncName    => cv_ProcOrFuncName
                         ,pt_i_ProgressIndicator => gvv_ProgressIndicator
                         ,pt_i_ModuleMessage     => '      - '
                                                  ||vn_ListValueCount
                                                  ||' values for "'
                                                  ||vt_ListParameterCode
                                                  ||'" List retrieved.'
                         ,pt_i_OracleError       => NULL
                         );
                    --
               END IF;
               --
               IF   vn_ListValueCount = 0
               THEN
                    --
                    vb_OkayToExtract := FALSE;
                    --
                    xxmx_utilities_pkg.log_module_message
                         (
                          pt_i_ApplicationSuite  => gct_ApplicationSuite
                         ,pt_i_Application       => gct_Application
                         ,pt_i_BusinessEntity    => gct_BusinessEntity
                         ,pt_i_SubEntity         => pt_i_SubEntity
                         ,pt_i_Phase             => ct_Phase
                         ,pt_i_Severity          => 'WARNING'
                         ,pt_i_PackageName       => gcv_PackageName
                         ,pt_i_ProcOrFuncName    => cv_ProcOrFuncName
                         ,pt_i_ProgressIndicator => gvv_ProgressIndicator
                         ,pt_i_ModuleMessage     => '    - No "'
                                                  ||vt_ListParameterCode
                                                  ||'" parameters defined in "xxmx_migration_parameters" table.  GL Balances can not be extracted at this time.'
                         ,pt_i_OracleError       => gvt_ReturnMessage
                         );
                    --
               END IF;

        gvv_ProgressIndicator := '0050';
        --
        vt_ListParameterCode := 'EXTRACT_YEAR';
        vn_ListValueCount    := 0;
        gvv_ReturnStatus     := '';
        gvt_ReturnMessage    := '';
        --
        xxmx_utilities_pkg.log_module_message
                    (
                     pt_i_ApplicationSuite  => gct_ApplicationSuite
                    ,pt_i_Application       => gct_Application
                    ,pt_i_BusinessEntity    => gct_BusinessEntity
                    ,pt_i_SubEntity         => vt_SubEntity
                    ,pt_i_MigrationSetID    => vt_MigrationSetID
                    ,pt_i_Phase             => ct_Phase
                    ,pt_i_Severity          => 'NOTIFICATION'
                    ,pt_i_PackageName       => gcv_PackageName
                    ,pt_i_ProcOrFuncName    => cv_ProcOrFuncName
                    ,pt_i_ProgressIndicator => gvv_ProgressIndicator
                    ,pt_i_ModuleMessage     => '    - Retrieving "'||vt_ListParameterCode||'" List from Migration Parameters table:'
                    ,pt_i_OracleError       => NULL
                    );
               --

        ExtractYear_tbl := xxmx_utilities_pkg.get_parameter_value_list
                                       (
                                        pt_i_ApplicationSuite => gct_ApplicationSuite
                                       ,pt_i_Application      => gct_Application
                                       ,pt_i_BusinessEntity   => gct_BusinessEntity
                                       ,pt_i_SubEntity        => 'OPEN_BAL'
                                       ,pt_i_ParameterCode    => vt_ListParameterCode
                                       ,pn_o_ReturnCount      => vn_ListValueCount
                                       ,pv_o_ReturnStatus     => gvv_ReturnStatus
                                       ,pv_o_ReturnMessage    => gvt_ReturnMessage
                                       );
               --
        IF   gvv_ReturnStatus = 'F' THEN
            --
            xxmx_utilities_pkg.log_module_message
                         (
                          pt_i_ApplicationSuite  => gct_ApplicationSuite
                         ,pt_i_Application       => gct_Application
                         ,pt_i_BusinessEntity    => gct_BusinessEntity
                         ,pt_i_SubEntity         => vt_SubEntity
                         ,pt_i_MigrationSetID    => vt_MigrationSetID
                         ,pt_i_Phase             => ct_Phase
                         ,pt_i_Severity          => 'ERROR'
                         ,pt_i_PackageName       => gcv_PackageName
                         ,pt_i_ProcOrFuncName    => cv_ProcOrFuncName
                         ,pt_i_ProgressIndicator => gvv_ProgressIndicator
                         ,pt_i_ModuleMessage     => '      - Oracle error in called procedure "xxmx_utilities_pkg.get_parameter_value_list".  "'
                                                  ||vt_ListParameterCode
                                                  ||'" List could not be retrieved.'
                         ,pt_i_OracleError       => gvt_ReturnMessage
                         );
            --
            RAISE e_ModuleError;
            --
        ELSE
            --
            xxmx_utilities_pkg.log_module_message
                         (
                          pt_i_ApplicationSuite  => gct_ApplicationSuite
                         ,pt_i_Application       => gct_Application
                         ,pt_i_BusinessEntity    => gct_BusinessEntity
                         ,pt_i_SubEntity         => vt_SubEntity
                         ,pt_i_MigrationSetID    => vt_MigrationSetID
                         ,pt_i_Phase             => ct_Phase
                         ,pt_i_Severity          => 'NOTIFICATION'
                         ,pt_i_PackageName       => gcv_PackageName
                         ,pt_i_ProcOrFuncName    => cv_ProcOrFuncName
                         ,pt_i_ProgressIndicator => gvv_ProgressIndicator
                         ,pt_i_ModuleMessage     => '      - '
                                                  ||vn_ListValueCount
                                                  ||' values for "'
                                                  ||vt_ListParameterCode
                                                  ||'" List retrieved.'
                         ,pt_i_OracleError         => NULL
                         );
                    --
        END IF;
        --
        IF   vn_ListValueCount = 0 THEN
                    --
                    vb_OkayToExtract := FALSE;
                    xxmx_utilities_pkg.log_module_message
                         (
                          pt_i_ApplicationSuite    => gct_ApplicationSuite
                         ,pt_i_Application         => gct_Application
                         ,pt_i_BusinessEntity      => gct_BusinessEntity
                         ,pt_i_SubEntity           => vt_SubEntity
                         ,pt_i_MigrationSetID      => vt_MigrationSetID
                         ,pt_i_Phase               => ct_Phase
                         ,pt_i_Severity            => 'WARNING'
                         ,pt_i_PackageName         => gcv_PackageName
                         ,pt_i_ProcOrFuncName      => cv_ProcOrFuncName
                         ,pt_i_ProgressIndicator   => gvv_ProgressIndicator
                         ,pt_i_ModuleMessage       => '    - No "'
                                                    ||vt_ListParameterCode
                                                    ||'" parameters defined in "xxmx_migration_parameters" table.  GL Balances can not be extracted at this time.'
                         ,pt_i_OracleError         => gvt_ReturnMessage
                         );
                    --
        END IF;
        --
        --
        -- Retrieve GL Period Name List
        --
        --
        gvv_ProgressIndicator := '0060';
        --
        vt_ListParameterCode := 'PERIOD_NAME';
        vn_ListValueCount    := 0;
        gvv_ReturnStatus     := '';
        gvt_ReturnMessage    := '';
        --
        xxmx_utilities_pkg.log_module_message
                    (
                     pt_i_ApplicationSuite  => gct_ApplicationSuite
                    ,pt_i_Application       => gct_Application
                    ,pt_i_BusinessEntity    => gct_BusinessEntity
                    ,pt_i_SubEntity         => vt_SubEntity
                    ,pt_i_MigrationSetID    => vt_MigrationSetID
                    ,pt_i_Phase             => ct_Phase
                    ,pt_i_Severity          => 'NOTIFICATION'
                    ,pt_i_PackageName       => gcv_PackageName
                    ,pt_i_ProcOrFuncName    => cv_ProcOrFuncName
                    ,pt_i_ProgressIndicator => gvv_ProgressIndicator
                    ,pt_i_ModuleMessage     => '    - Retrieving "'
                                             ||vt_ListParameterCode
                                             ||'" List from Migration Parameters table:'
                    ,pt_i_OracleError       => NULL
                    );
        --
        PeriodName_tbl := xxmx_utilities_pkg.get_parameter_value_list
                                      (
                                       pt_i_ApplicationSuite => gct_ApplicationSuite
                                      ,pt_i_Application      => gct_Application
                                      ,pt_i_BusinessEntity   => gct_BusinessEntity
                                      ,pt_i_SubEntity        => 'OPEN_BAL'
                                      ,pt_i_ParameterCode    => vt_ListParameterCode
                                      ,pn_o_ReturnCount      => vn_ListValueCount
                                      ,pv_o_ReturnStatus     => gvv_ReturnStatus
                                      ,pv_o_ReturnMessage    => gvt_ReturnMessage
                                      );
        --
        IF   gvv_ReturnStatus = 'F' THEN
            --
            xxmx_utilities_pkg.log_module_message
                         (
                          pt_i_ApplicationSuite  => gct_ApplicationSuite
                         ,pt_i_Application       => gct_Application
                         ,pt_i_BusinessEntity    => gct_BusinessEntity
                         ,pt_i_SubEntity         => vt_SubEntity
                         ,pt_i_MigrationSetID    => vt_MigrationSetID
                         ,pt_i_Phase             => ct_Phase
                         ,pt_i_Severity          => 'ERROR'
                         ,pt_i_PackageName       => gcv_PackageName
                         ,pt_i_ProcOrFuncName    => cv_ProcOrFuncName
                         ,pt_i_ProgressIndicator => gvv_ProgressIndicator
                         ,pt_i_ModuleMessage     => '      - Oracle error in called procedure "xxmx_utilities_pkg.get_parameter_value_list".  "'
                                                  ||vt_ListParameterCode
                                                  ||'" List could not be retrieved.'
                         ,pt_i_OracleError       => gvt_ReturnMessage
                         );
                    --
            RAISE e_ModuleError;
            --
        ELSE
            --
            xxmx_utilities_pkg.log_module_message
                         (
                          pt_i_ApplicationSuite  => gct_ApplicationSuite
                         ,pt_i_Application       => gct_Application
                         ,pt_i_BusinessEntity    => gct_BusinessEntity
                         ,pt_i_SubEntity         => vt_SubEntity
                         ,pt_i_MigrationSetID    => vt_MigrationSetID
                         ,pt_i_Phase             => ct_Phase
                         ,pt_i_Severity          => 'NOTIFICATION'
                         ,pt_i_PackageName       => gcv_PackageName
                         ,pt_i_ProcOrFuncName    => cv_ProcOrFuncName
                         ,pt_i_ProgressIndicator => gvv_ProgressIndicator
                         ,pt_i_ModuleMessage     => '      - '
                                                  ||vn_ListValueCount
                                                  ||' values for "'
                                                  ||vt_ListParameterCode
                                                  ||'" List retrieved.'
                         ,pt_i_OracleError         => NULL
                         );
                    --
        END IF;
        --
        IF   vn_ListValueCount = 0 THEN
            --
            vb_OkayToExtract := FALSE;
            xxmx_utilities_pkg.log_module_message
                         (
                          pt_i_ApplicationSuite    => gct_ApplicationSuite
                         ,pt_i_Application         => gct_Application
                         ,pt_i_BusinessEntity      => gct_BusinessEntity
                         ,pt_i_SubEntity           => vt_SubEntity
                         ,pt_i_MigrationSetID      => vt_MigrationSetID
                         ,pt_i_Phase               => ct_Phase
                         ,pt_i_Severity            => 'WARNING'
                         ,pt_i_PackageName         => gcv_PackageName
                         ,pt_i_ProcOrFuncName      => cv_ProcOrFuncName
                         ,pt_i_ProgressIndicator   => gvv_ProgressIndicator
                         ,pt_i_ModuleMessage       => '    - No "'
                                                    ||vt_ListParameterCode
                                                    ||'" parameters defined in "xxmx_migration_parameters" table.  GL Balances can not be extracted at this time.'
                         ,pt_i_OracleError         => gvt_ReturnMessage
                         );
                    --
        END IF;
        --
        --
        -- If there are no Extract Parameters in the "xxmx_migration_parameters" table
        -- (those which are there have to be enabled), no balances can be extracted.
        --
        --
        gvv_ProgressIndicator := '0070';
        --
        IF   vb_OkayToExtract THEN
            --
            --
            -- The Extract Parameters were successfully retrieved so now
            -- initialize the detail record for the GL Balances.
            --
            xxmx_utilities_pkg.init_migration_details
                         (
                          pt_i_ApplicationSuite  => gct_ApplicationSuite
                         ,pt_i_Application       => gct_Application
                         ,pt_i_BusinessEntity    => gct_BusinessEntity
                         ,pt_i_SubEntity         => vt_SubEntity
                         ,pt_i_MigrationSetID    => vt_MigrationSetID
                         ,pt_i_StagingTable      => ct_StgTable
                         ,pt_i_ExtractStartDate  => SYSDATE
                         );
                    --
            xxmx_utilities_pkg.log_module_message
                         (
                          pt_i_ApplicationSuite  => gct_ApplicationSuite
                         ,pt_i_Application       => gct_Application
                         ,pt_i_BusinessEntity    => gct_BusinessEntity
                         ,pt_i_SubEntity         => vt_SubEntity
                         ,pt_i_MigrationSetID    => vt_MigrationSetID
                         ,pt_i_Phase             => ct_Phase
                         ,pt_i_Severity          => 'NOTIFICATION'
                         ,pt_i_PackageName       => gcv_PackageName
                         ,pt_i_ProcOrFuncName    => cv_ProcOrFuncName
                         ,pt_i_ProgressIndicator => gvv_ProgressIndicator
                         ,pt_i_ModuleMessage     => '    - Staging Table "'||ct_StgTable||'" reporting details initialised.'
                         ,pt_i_OracleError       => NULL
                         );
            --
            --  loop through the Ledger Name list and for each one:
            --
            -- a) Retrieve COA Structure Details pertaining to the Ledger.
            -- b) Extract the Balances for the Ledger.
            --
            gvv_ProgressIndicator := '0090';
            --
            FOR LedgerName_idx
            IN LedgerName_tbl.FIRST..LedgerName_tbl.LAST
            LOOP
                xxmx_utilities_pkg.log_module_message
                                 (
                                  pt_i_ApplicationSuite  => gct_ApplicationSuite
                                 ,pt_i_Application       => gct_Application
                                 ,pt_i_BusinessEntity    => gct_BusinessEntity
                                 ,pt_i_SubEntity         => vt_SubEntity
                                 ,pt_i_MigrationSetID    => vt_MigrationSetID
                                 ,pt_i_Phase             => ct_Phase
                                 ,pt_i_Severity          => 'NOTIFICATION'
                                 ,pt_i_PackageName       => gcv_PackageName
                                 ,pt_i_ProcOrFuncName    => cv_ProcOrFuncName
                                 ,pt_i_ProgressIndicator => gvv_ProgressIndicator
                                 ,pt_i_ModuleMessage     => '    - Loop: Ledger name.'
                                 ,pt_i_OracleError       => NULL
                                 );
                --
                -- Loop through Extract Years List
                --
                FOR ExtractYear_idx
                IN ExtractYear_tbl.FIRST..ExtractYear_tbl.LAST
                LOOP
                    xxmx_utilities_pkg.log_module_message
                                 (
                                  pt_i_ApplicationSuite  => gct_ApplicationSuite
                                 ,pt_i_Application       => gct_Application
                                 ,pt_i_BusinessEntity    => gct_BusinessEntity
                                 ,pt_i_SubEntity         => vt_SubEntity
                                 ,pt_i_MigrationSetID    => vt_MigrationSetID
                                 ,pt_i_Phase             => ct_Phase
                                 ,pt_i_Severity          => 'NOTIFICATION'
                                 ,pt_i_PackageName       => gcv_PackageName
                                 ,pt_i_ProcOrFuncName    => cv_ProcOrFuncName
                                 ,pt_i_ProgressIndicator => gvv_ProgressIndicator
                                 ,pt_i_ModuleMessage     => '    - Loop: Year.'
                                 ,pt_i_OracleError       => NULL
                                 );
                    --
                    --
                    -- The following variable will be set to TRUE if any of the Period Names
                    -- in the Period Name Parameters list exist for the current Extract Year
                    -- Parameter.  If no Period Name Parameters match to the current Extract
                    -- Year Parameter this variable will remain FALSE.
                    --
                    -- This is so an INFORMATION log message can be issued if there are no
                    -- Period Name Parameters which match to the current Extract Year Parameter.
                    --
                    vb_PeriodAndYearMatch := FALSE;
                    --
                    --
                    -- Loop through GL Period Names List
                    --
                    --
                    FOR PeriodName_idx
                    IN PeriodName_tbl.FIRST..PeriodName_tbl.LAST
                    LOOP
                        xxmx_utilities_pkg.log_module_message
                                     (
                                      pt_i_ApplicationSuite  => gct_ApplicationSuite
                                     ,pt_i_Application       => gct_Application
                                     ,pt_i_BusinessEntity    => gct_BusinessEntity
                                     ,pt_i_SubEntity         => vt_SubEntity
                                     ,pt_i_MigrationSetID    => vt_MigrationSetID
                                     ,pt_i_Phase             => ct_Phase
                                     ,pt_i_Severity          => 'NOTIFICATION'
                                     ,pt_i_PackageName       => gcv_PackageName
                                     ,pt_i_ProcOrFuncName    => cv_ProcOrFuncName
                                     ,pt_i_ProgressIndicator => gvv_ProgressIndicator
                                     ,pt_i_ModuleMessage     => '    - Loop: Period Name '||PeriodName_tbl(PeriodName_idx)
                                     ,pt_i_OracleError       => NULL
                                     );
                        --
                        gvn_ExistenceCount := 0;
                        --
                        /*
                        ** Verify if the current Period Name Parameter exists
                        ** as a GL Period in the GL_PERIODS table for the current
                        ** Source Ledger Name and Extract Year Parameters.
                        */
                        --
                        gvv_ProgressIndicator := '0130';
                        --
                        --
                        -- Verify if the current Period Name Parameter exists in gl_ledgers and gl_periods tables
                        --
                        SELECT  COUNT(*)
                        INTO    gvn_ExistenceCount
                        FROM    apps.gl_ledgers@MXDM_NVIS_EXTRACT  gl2
                                ,apps.gl_periods@MXDM_NVIS_EXTRACT  gp
                        WHERE   1 = 1
                        AND     gl2.name           = LedgerName_tbl(LedgerName_idx)
                        AND     gp.period_set_name = gl2.period_set_name
                        AND     gp.period_year     = ExtractYear_tbl(ExtractYear_idx)
                        AND     gp.period_name     = PeriodName_tbl(PeriodName_idx);
                        --
                        IF   gvn_ExistenceCount = 0 THEN
                            xxmx_utilities_pkg.log_module_message
                                            (
                                             pt_i_ApplicationSuite  => gct_ApplicationSuite
                                            ,pt_i_Application       => gct_Application
                                            ,pt_i_BusinessEntity    => gct_BusinessEntity
                                            ,pt_i_SubEntity         => vt_SubEntity
                                            ,pt_i_MigrationSetID    => vt_MigrationSetID
                                            ,pt_i_Phase             => ct_Phase
                                            ,pt_i_Severity          => 'NOTIFICATION'
                                            ,pt_i_PackageName       => gcv_PackageName
                                            ,pt_i_ProcOrFuncName    => cv_ProcOrFuncName
                                            ,pt_i_ProgressIndicator => gvv_ProgressIndicator
                                            ,pt_i_ModuleMessage     => '      - No data found in EBS (source system) for Year/Period '
                                                                     ||ExtractYear_tbl(ExtractYear_idx)
                                                                     ||PeriodName_tbl(PeriodName_idx)||' Foe ledger '
                                                                     ||LedgerName_tbl(LedgerName_idx)
                                            ,pt_i_OracleError       => NULL
                                            );
                        ELSE
                            --
                            --
                            -- Current Period Name Parameter exists in the GL_PERIODS table
                            -- for the current Source Ledger Name and Extract Year so the
                            -- Balances extract can proceed.
                            --
                            --
                            vb_PeriodAndYearMatch := TRUE;
                            --
                            xxmx_utilities_pkg.log_module_message
                                             (
                                              pt_i_ApplicationSuite  => gct_ApplicationSuite
                                             ,pt_i_Application       => gct_Application
                                             ,pt_i_BusinessEntity    => gct_BusinessEntity
                                             ,pt_i_SubEntity         => vt_SubEntity
                                             ,pt_i_MigrationSetID    => vt_MigrationSetID
                                             ,pt_i_Phase             => ct_Phase
                                             ,pt_i_Severity          => 'NOTIFICATION'
                                             ,pt_i_PackageName       => gcv_PackageName
                                             ,pt_i_ProcOrFuncName    => cv_ProcOrFuncName
                                             ,pt_i_ProgressIndicator => gvv_ProgressIndicator
                                             ,pt_i_ModuleMessage     => '      - Extracting "'
                                                                      ||gct_Application
                                                                      ||' '
                                                                      ||vt_SubEntity
                                                                      ||'" for GL Ledger Name "'
                                                                      ||LedgerName_tbl(LedgerName_idx)
                                                                      ||'" and Year "'
                                                                      ||ExtractYear_tbl(ExtractYear_idx)
                                                                      ||'", Period Name "'
                                                                      ||PeriodName_tbl(PeriodName_idx)
                                                                      ||'".'
                                             ,pt_i_OracleError       => NULL
                                             );
                            --
                            gvv_ProgressIndicator := '0140';
                            --
                            OPEN GLBalances_cur
                                (
                                                   LedgerName_tbl(LedgerName_idx) 
                                                  ,ExtractYear_tbl(ExtractYear_idx)
                                                  ,PeriodName_tbl(PeriodName_idx)       
                                );
                            --
                            gvv_ProgressIndicator := '0150';
                            --
                            LOOP
                            --
                                FETCH        GLBalances_cur
                                BULK COLLECT
                                INTO         GLBalances_tbl
                                LIMIT        xxmx_utilities_pkg.gcn_BulkCollectLimit;
                                --
                                EXIT WHEN    GLBalances_tbl.COUNT = 0;
                                --
                                xxmx_utilities_pkg.log_module_message
                                                (
                                                 pt_i_ApplicationSuite  => gct_ApplicationSuite
                                                ,pt_i_Application       => gct_Application
                                                ,pt_i_BusinessEntity    => gct_BusinessEntity
                                                ,pt_i_SubEntity         => vt_SubEntity
                                                ,pt_i_MigrationSetID    => vt_MigrationSetID
                                                ,pt_i_Phase             => ct_Phase
                                                ,pt_i_Severity          => 'NOTIFICATION'
                                                ,pt_i_PackageName       => gcv_PackageName
                                                ,pt_i_ProcOrFuncName    => cv_ProcOrFuncName
                                                ,pt_i_ProgressIndicator => gvv_ProgressIndicator
                                                ,pt_i_ModuleMessage     => '    - Record Count '||GLBalances_tbl.COUNT
                                                ,pt_i_OracleError       => NULL
                                                );
                                --
                                gvv_ProgressIndicator := '0160';
                                --
                                FORALL GLBalances_idx IN 1..GLBalances_tbl.COUNT

                             --
--                    DELETE
--                    FROM   xxmx_gl_opening_balances_stg
--                    WHERE  1 = 1
--                    AND    migration_set_id = pt_i_MigrationSetID;
                    --


                                INSERT
                                INTO   xxmx_stg.xxmx_gl_opening_balances_stg
                                                              (
                                                               migration_set_id
                                                              ,group_id
                                                              ,migration_set_name
                                                              ,migration_status
                                                              ,fusion_status_code
                                                              ,ledger_name
                                                              ,ledger_id
                                                              ,accounting_date
                                                              ,user_je_source_name
                                                              ,user_je_category_name
                                                              ,currency_code
-- MA 27/04/2022 become date_created
--                                                              ,journal_entry_creation_date
                                                              ,date_created
                                                              ,actual_flag
                                                              ,segment1
                                                              ,segment2
                                                              ,segment3
                                                              ,segment4
                                                              ,segment5
                                                              ,segment6
                                                              ,segment7
                                                              ,segment8
                                                              ,segment9
                                                              ,segment10
                                                              ,segment11
                                                              ,segment12
                                                              ,segment13
                                                              ,segment14
                                                              ,segment15
                                                              ,segment16
                                                              ,segment17
                                                              ,segment18
                                                              ,segment19
                                                              ,segment20
                                                              ,segment21
                                                              ,segment22
                                                              ,segment23
                                                              ,segment24
                                                              ,segment25
                                                              ,segment26
                                                              ,segment27
                                                              ,segment28
                                                              ,segment29
                                                              ,segment30
                                                              ,entered_dr
                                                              ,entered_cr
                                                              ,accounted_dr
                                                              ,accounted_cr
                                                              ,reference1
                                                              ,reference2
                                                              ,reference3
                                                              ,reference4
                                                              ,reference5
                                                              ,reference6
                                                              ,reference7
                                                              ,reference8
                                                              ,reference9
                                                              ,reference10
                                                              ,stat_amount
                                                              ,user_currency_conversion_type
                                                              ,currency_conversion_date
                                                              ,currency_conversion_rate
                                                              ,attribute_category
                                                              ,attribute1
                                                              ,attribute2
                                                              ,attribute3
                                                              ,attribute4
                                                              ,attribute5
                                                              ,attribute6
                                                              ,attribute7
                                                              ,attribute8
                                                              ,attribute9
                                                              ,attribute10
                                                              ,attribute11
                                                              ,attribute12
                                                              ,attribute13
                                                              ,attribute14
                                                              ,attribute15
                                                              ,attribute16
                                                              ,attribute17
                                                              ,attribute18
                                                              ,attribute19
                                                              ,attribute20
                                                              ,attribute_category3
-- MA 27/04/2022 no longer required
--                                                              ,average_journal_flag
                                                              ,originating_bal_seg_value
                                                              ,encumbrance_type_id
                                                              ,jgzz_recon_ref
                                                              ,period_name
                                                              )
                                                  VALUES
                                                              (
                                                               vt_MigrationSetID                                             -- migration_set_id
                                                              ,vt_MigrationSetID                                             -- group_id
                                                              ,gvt_MigrationSetName                                          -- migration_set_name
                                                              ,'EXTRACTED'                                                   -- migration_status
                                                              ,GLBalances_tbl(GLBalances_idx).fusion_status_code             -- fusion_status_code
                                                              ,GLBalances_tbl(GLBalances_idx).ledger_name                    -- ledger_name
                                                              ,GLBalances_tbl(GLBalances_idx).ledger_id                        -- ledger_id
                                                              ,GLBalances_tbl(GLBalances_idx).accounting_date                -- accounting_date
                                                              ,GLBalances_tbl(GLBalances_idx).user_je_source_name            -- user_je_source_name
                                                              ,GLBalances_tbl(GLBalances_idx).user_je_category_name          -- user_je_category_name
                                                              ,GLBalances_tbl(GLBalances_idx).currency_code                  -- currency_code
-- MA 27/04/2022 now date_created
--                                                              ,GLBalances_tbl(GLBalances_idx).journal_entry_creation_date    -- journal_entry_creation_date
                                                              ,GLBalances_tbl(GLBalances_idx).date_created    -- date_created
                                                              ,GLBalances_tbl(GLBalances_idx).actual_flag                    -- actual_flag
                                                              ,GLBalances_tbl(GLBalances_idx).segment1                       -- segment1
                                                              ,GLBalances_tbl(GLBalances_idx).segment2                       -- segment2
                                                              ,GLBalances_tbl(GLBalances_idx).segment3                       -- segment3
                                                              ,GLBalances_tbl(GLBalances_idx).segment4                       -- segment4
                                                              ,GLBalances_tbl(GLBalances_idx).segment5                       -- segment5
                                                              ,GLBalances_tbl(GLBalances_idx).segment6                       -- segment6
                                                              ,GLBalances_tbl(GLBalances_idx).segment7                       -- segment7
                                                              ,GLBalances_tbl(GLBalances_idx).segment8                       -- segment8
                                                              ,GLBalances_tbl(GLBalances_idx).segment9                       -- segment9
                                                              ,GLBalances_tbl(GLBalances_idx).segment10                      -- segment10
                                                              ,GLBalances_tbl(GLBalances_idx).segment11                      -- segment11
                                                              ,GLBalances_tbl(GLBalances_idx).segment12                      -- segment12
                                                              ,GLBalances_tbl(GLBalances_idx).segment13                      -- segment13
                                                              ,GLBalances_tbl(GLBalances_idx).segment14                      -- segment14
                                                              ,GLBalances_tbl(GLBalances_idx).segment15                      -- segment15
                                                              ,GLBalances_tbl(GLBalances_idx).segment16                      -- segment16
                                                              ,GLBalances_tbl(GLBalances_idx).segment17                      -- segment17
                                                              ,GLBalances_tbl(GLBalances_idx).segment18                      -- segment18
                                                              ,GLBalances_tbl(GLBalances_idx).segment19                      -- segment19
                                                              ,GLBalances_tbl(GLBalances_idx).segment20                      -- segment20
                                                              ,GLBalances_tbl(GLBalances_idx).segment21                      -- segment21
                                                              ,GLBalances_tbl(GLBalances_idx).segment22                      -- segment22
                                                              ,GLBalances_tbl(GLBalances_idx).segment23                      -- segment23
                                                              ,GLBalances_tbl(GLBalances_idx).segment24                      -- segment24
                                                              ,GLBalances_tbl(GLBalances_idx).segment25                      -- segment25
                                                              ,GLBalances_tbl(GLBalances_idx).segment26                      -- segment26
                                                              ,GLBalances_tbl(GLBalances_idx).segment27                      -- segment27
                                                              ,GLBalances_tbl(GLBalances_idx).segment28                      -- segment28
                                                              ,GLBalances_tbl(GLBalances_idx).segment29                      -- segment29
                                                              ,GLBalances_tbl(GLBalances_idx).segment30                      -- segment30
                                                              ,GLBalances_tbl(GLBalances_idx).entered_dr                     -- entered_dr
                                                              ,GLBalances_tbl(GLBalances_idx).entered_cr                     -- entered_cr
                                                              ,GLBalances_tbl(GLBalances_idx).accounted_dr                   -- accounted_dr
                                                              ,GLBalances_tbl(GLBalances_idx).accounted_cr                   -- accounted_cr
                                                              ,GLBalances_tbl(GLBalances_idx).reference1                     -- reference1
                                                              ,GLBalances_tbl(GLBalances_idx).reference2                     -- reference2
                                                              ,GLBalances_tbl(GLBalances_idx).reference3                     -- reference3
                                                              ,GLBalances_tbl(GLBalances_idx).reference4                     -- reference4
                                                              ,GLBalances_tbl(GLBalances_idx).reference5                     -- reference5
                                                              ,GLBalances_tbl(GLBalances_idx).reference6                     -- reference6
                                                              ,GLBalances_tbl(GLBalances_idx).reference7                     -- reference7
                                                              ,GLBalances_tbl(GLBalances_idx).reference8                     -- reference8
                                                              ,GLBalances_tbl(GLBalances_idx).reference9                     -- reference9
                                                              ,GLBalances_tbl(GLBalances_idx).reference10                    -- reference10
                                                              ,GLBalances_tbl(GLBalances_idx).stat_amount                    -- stat_amount
                                                              ,GLBalances_tbl(GLBalances_idx).user_currency_conversion_type  -- user_currency_conversion_type
                                                              ,GLBalances_tbl(GLBalances_idx).currency_conversion_date       -- currency_conversion_date
                                                              ,GLBalances_tbl(GLBalances_idx).currency_conversion_rate       -- currency_conversion_rate
                                                              ,GLBalances_tbl(GLBalances_idx).attribute_category             -- attribute_category
                                                              ,GLBalances_tbl(GLBalances_idx).attribute1                     -- attribute1
                                                              ,GLBalances_tbl(GLBalances_idx).attribute2                     -- attribute2
                                                              ,GLBalances_tbl(GLBalances_idx).attribute3                     -- attribute3
                                                              ,GLBalances_tbl(GLBalances_idx).attribute4                     -- attribute4
                                                              ,GLBalances_tbl(GLBalances_idx).attribute5                     -- attribute5
                                                              ,GLBalances_tbl(GLBalances_idx).attribute6                     -- attribute6
                                                              ,GLBalances_tbl(GLBalances_idx).attribute7                     -- attribute7
                                                              ,GLBalances_tbl(GLBalances_idx).attribute8                     -- attribute8
                                                              ,GLBalances_tbl(GLBalances_idx).attribute9                     -- attribute9
                                                              ,GLBalances_tbl(GLBalances_idx).attribute10                    -- attribute10
                                                              ,GLBalances_tbl(GLBalances_idx).attribute11                    -- attribute11
                                                              ,GLBalances_tbl(GLBalances_idx).attribute12                    -- attribute12
                                                              ,GLBalances_tbl(GLBalances_idx).attribute13                    -- attribute13
                                                              ,GLBalances_tbl(GLBalances_idx).attribute14                    -- attribute14
                                                              ,GLBalances_tbl(GLBalances_idx).attribute15                    -- attribute15
                                                              ,GLBalances_tbl(GLBalances_idx).attribute16                    -- attribute16
                                                              ,GLBalances_tbl(GLBalances_idx).attribute17                    -- attribute17
                                                              ,GLBalances_tbl(GLBalances_idx).attribute18                    -- attribute18
                                                              ,GLBalances_tbl(GLBalances_idx).attribute19                    -- attribute19
                                                              ,GLBalances_tbl(GLBalances_idx).attribute20                    -- attribute20
                                                              ,GLBalances_tbl(GLBalances_idx).attribute_category3            -- attribute_category3
-- MA 27/04/2022 no longer required
--                                                              ,GLBalances_tbl(GLBalances_idx).average_journal_flag           -- average_journal_flag
                                                              ,GLBalances_tbl(GLBalances_idx).originating_bal_seg_value      -- originating_bal_seg_value
                                                              ,GLBalances_tbl(GLBalances_idx).encumbrance_type_id            -- encumbrance_type_id
                                                              ,GLBalances_tbl(GLBalances_idx).jgzz_recon_ref                 -- jgzz_recon_ref
                                                              ,GLBalances_tbl(GLBalances_idx).period_name                    -- period_name
                                                              );
                                                  --
                                             --** END FORALL
                                             --
                            END LOOP; --** GLBalances_cur BULK COLLECT LOOP
                            --
                            gvv_ProgressIndicator := '0170';
                            --
                            CLOSE GLBalances_cur;
                            --
                            END IF; --** IF gvn_ExistenceCount >0
                            --
                        END LOOP; --** PeriodName_tbl LOOP
                        --
                        gvv_ProgressIndicator := '0180';
                        --
                        IF   NOT vb_PeriodAndYearMatch
                        THEN
                            --
                            xxmx_utilities_pkg.log_module_message
                                        (
                                         pt_i_ApplicationSuite  => gct_ApplicationSuite
                                        ,pt_i_Application       => gct_Application
                                        ,pt_i_BusinessEntity    => gct_BusinessEntity
                                        ,pt_i_SubEntity         => vt_SubEntity
                                        ,pt_i_MigrationSetID    => vt_MigrationSetID
                                        ,pt_i_Phase             => ct_Phase
                                        ,pt_i_Severity          => 'NOTIFICATION'
                                        ,pt_i_PackageName       => gcv_PackageName
                                        ,pt_i_ProcOrFuncName    => cv_ProcOrFuncName
                                        ,pt_i_ProgressIndicator => gvv_ProgressIndicator
                                        ,pt_i_ModuleMessage     => '      - No Period Name Parameters correspond to Extract Year "'
                                                                 ||ExtractYear_tbl(ExtractYear_idx)
                                                                 ||'" and the Period Set associated with Source Ledger Name "'
                                                                 ||LedgerName_tbl(LedgerName_idx)
                                                                 ||'".  No Balances were extracted for this year.'
                                        ,pt_i_OracleError       => NULL
                                        );
                            --
                        END IF; --** IF NOT vb_PeriodAndYearMatch
                        --
                    END LOOP; --** ExtractYear_tbl LOOP
                    --
                END LOOP; --** Ledger scope tbl LOOP
                --
                gvv_ProgressIndicator := '0190';
                --
                /*
                ** Obtain the count of rows inserted.  We cannot use SQL$ROWCOUNT here because of the LIMIT
                ** clause on the BULK COLLECT statement.  The rowcount will be reset each time the limit
                ** is reached.  Also the rowcount for this extract will report TOTAL rows extracted across
                ** all GL Ledgers in the Migration Set.
                */
                --
                gvn_RowCount := xxmx_utilities_pkg.get_row_count
                                         (
                                          gct_StgSchema
                                         ,ct_StgTable
                                         ,vt_MigrationSetID
                                         );
                --
                xxmx_utilities_pkg.log_module_message
                         (
                          pt_i_ApplicationSuite  => gct_ApplicationSuite
                         ,pt_i_Application       => gct_Application
                         ,pt_i_BusinessEntity    => gct_BusinessEntity
                         ,pt_i_SubEntity         => vt_SubEntity
                         ,pt_i_MigrationSetID    => vt_MigrationSetID
                         ,pt_i_Phase             => ct_Phase
                         ,pt_i_Severity          => 'NOTIFICATION'
                         ,pt_i_PackageName       => gcv_PackageName
                         ,pt_i_ProcOrFuncName    => cv_ProcOrFuncName
                         ,pt_i_ProgressIndicator => gvv_ProgressIndicator
                         ,pt_i_ModuleMessage     => '  - Extraction complete.'
                         ,pt_i_OracleError       => NULL
                         );
                --
                --
                COMMIT;
                --
                -- Update the migration details (Migration status will be automatically determined
                -- in the called procedure dependant on the Phase and if an Error Message has been
                -- passed).
                --
                gvv_ProgressIndicator := '0200';
                --
                --
                xxmx_utilities_pkg.upd_migration_details
                         (
                          pt_i_MigrationSetID          => vt_MigrationSetID
                         ,pt_i_BusinessEntity          => gct_BusinessEntity
                         ,pt_i_SubEntity               => vt_SubEntity
                         ,pt_i_Phase                   => ct_Phase
                         ,pt_i_ExtractCompletionDate   => SYSDATE
                         ,pt_i_ExtractRowCount         => gvn_RowCount
                         ,pt_i_TransformTable          => NULL
                         ,pt_i_TransformStartDate      => NULL
                         ,pt_i_TransformCompletionDate => NULL
                         ,pt_i_ExportFileName          => NULL
                         ,pt_i_ExportStartDate         => NULL
                         ,pt_i_ExportCompletionDate    => NULL
                         ,pt_i_ExportRowCount          => NULL
                         ,pt_i_ErrorFlag               => NULL
                         );
                    --
                xxmx_utilities_pkg.log_module_message
                         (
                          pt_i_ApplicationSuite  => gct_ApplicationSuite
                         ,pt_i_Application       => gct_Application
                         ,pt_i_BusinessEntity    => gct_BusinessEntity
                         ,pt_i_SubEntity         => vt_SubEntity
                         ,pt_i_MigrationSetID    => vt_MigrationSetID
                         ,pt_i_Phase             => ct_Phase
                         ,pt_i_Severity          => 'NOTIFICATION'
                         ,pt_i_PackageName       => gcv_PackageName
                         ,pt_i_ProcOrFuncName    => cv_ProcOrFuncName
                         ,pt_i_ProgressIndicator => gvv_ProgressIndicator
                         ,pt_i_ModuleMessage     => '  - Migration Table "'
                                                  ||ct_StgTable
                                                  ||'" reporting details updated.'
                         ,pt_i_OracleError       => NULL
                         );
                    --
            END IF; --** vn_ListEntryCount > 0
            --
        ELSE
        --
            gvt_Severity      := 'ERROR';
            gvt_ModuleMessage := '- Migration Set not initialized.';
            --
            RAISE e_ModuleError;
               --
        END IF;
        --
        xxmx_utilities_pkg.log_module_message
               (
                pt_i_ApplicationSuite  => gct_ApplicationSuite
               ,pt_i_Application       => gct_Application
               ,pt_i_BusinessEntity    => gct_BusinessEntity
               ,pt_i_SubEntity         => vt_SubEntity
               ,pt_i_MigrationSetID    => vt_MigrationSetID
               ,pt_i_Phase             => ct_Phase
               ,pt_i_Severity          => 'NOTIFICATION'
               ,pt_i_PackageName       => gcv_PackageName
               ,pt_i_ProcOrFuncName    => cv_ProcOrFuncName
               ,pt_i_ProgressIndicator => gvv_ProgressIndicator
               ,pt_i_ModuleMessage     => 'Procedure "'
                                        ||gcv_PackageName
                                        ||'.'
                                        ||cv_ProcOrFuncName
                                        ||'" completed.'
               ,pt_i_OracleError       => NULL
               );
          --
EXCEPTION
          WHEN e_ModuleError THEN
                    --
                    IF   GLBalances_cur%ISOPEN
                    THEN
                         --
                         CLOSE GLBalances_cur;
                         --
                    END IF;
                    --
                    ROLLBACK;
                    --
                    xxmx_utilities_pkg.log_module_message
                         (
                          pt_i_ApplicationSuite  => gct_ApplicationSuite
                         ,pt_i_Application       => gct_Application
                         ,pt_i_BusinessEntity    => gct_BusinessEntity
                         ,pt_i_SubEntity         => vt_SubEntity
                         ,pt_i_MigrationSetID    => vt_MigrationSetID
                         ,pt_i_Phase             => ct_Phase
                         ,pt_i_Severity          => gvt_Severity
                         ,pt_i_PackageName       => gcv_PackageName
                         ,pt_i_ProcOrFuncName    => cv_ProcOrFuncName
                         ,pt_i_ProgressIndicator => gvv_ProgressIndicator
                         ,pt_i_ModuleMessage     => gvt_ModuleMessage
                         ,pt_i_OracleError       => NULL
                         );
                    --
                    RAISE;
                    --
               --** END e_ModuleError Exception
               --
          WHEN OTHERS
               THEN
                    --
                    IF   GLBalances_cur%ISOPEN
                    THEN
                         --
                         CLOSE GLBalances_cur;
                         --
                    END IF;
                    --
                    ROLLBACK;
                    --
                    gvt_OracleError := SUBSTR(
                                             SQLERRM
                                           ||'** ERROR_BACKTRACE: '
                                           ||dbms_utility.format_error_backtrace
                                            ,1
                                            ,4000
                                            );
                    --
                    xxmx_utilities_pkg.log_module_message
                         (
                          pt_i_ApplicationSuite  => gct_ApplicationSuite
                         ,pt_i_Application       => gct_Application
                         ,pt_i_BusinessEntity    => gct_BusinessEntity
                         ,pt_i_SubEntity         => vt_SubEntity
                         ,pt_i_MigrationSetID    => vt_MigrationSetID
                         ,pt_i_Phase             => ct_Phase
                         ,pt_i_Severity          => 'ERROR'
                         ,pt_i_PackageName       => gcv_PackageName
                         ,pt_i_ProcOrFuncName    => cv_ProcOrFuncName
                         ,pt_i_ProgressIndicator => gvv_ProgressIndicator
                         ,pt_i_ModuleMessage     => 'Oracle error encounted at after Progress Indicator.'
                         ,pt_i_OracleError       => gvt_OracleError
                         );
                    --
                    RAISE;
                    --
               --** END OTHERS Exception
               --
          --** END Exception Handler
          --
     END gl_opening_balances_stg;